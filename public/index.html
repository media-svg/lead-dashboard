<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ORA 4X Lead Command Center</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

<style>
* { box-sizing: border-box; margin: 0; padding: 0; }

body {
  font-family: 'Inter', sans-serif;
  background:
    radial-gradient(1200px 600px at 50% 30%, rgba(255,255,255,0.05), transparent 70%),
    linear-gradient(180deg, #111111 0%, #000000 100%);
  color: white;
  height: 100vh;
  padding: 60px;
}

.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.logo { height: 70px; }

.clock { font-size: 28px; opacity: 0.7; }

.counter-section {
  text-align: center;
  margin: 60px 0;
}

.waiting-label {
  font-size: 22px;
  letter-spacing: 3px;
  opacity: 0.6;
  margin-bottom: 10px;
}

.count {
  font-size: 130px;
  font-weight: 800;
}

.kpi-block {
  margin-top: 25px;
  font-size: 28px;
  font-weight: 700;
}

.kpi-block strong {
  font-size: 34px;
  font-weight: 800;
}

.avg-green { color: #22c55e; }
.avg-yellow { color: #facc15; }
.avg-red { color: #ef4444; }

.total-leads {
  margin-top: 15px;
  font-size: 24px;
  opacity: 0.85;
}

.board {
  max-width: 1200px;
  margin: 0 auto;
}

.lead-card {
  display: flex;
  justify-content: space-between;
  padding: 25px 35px;
  margin-bottom: 20px;
  border-radius: 14px;
  font-size: 28px;
}

.green { background: #15803d; }
.yellow { background: #ca8a04; color: black; }
.red { background: #b91c1c; }

.lead-info { display: flex; flex-direction: column; }
.lead-source { font-size: 16px; opacity: 0.9; }

.footer {
  position: absolute;
  bottom: 20px;
  right: 60px;
  font-size: 14px;
  opacity: 0.4;
}
</style>
</head>

<body>

<div class="header">
  <img src="logo.png" class="logo">
  <div class="clock" id="clock"></div>
</div>

<div class="counter-section">
  <div class="waiting-label">LEADS WAITING</div>
  <div class="count" id="count">0</div>

  <div class="kpi-block" id="avgContainer">
    <span id="avgTitle"></span><br>
    <strong><span id="avgResponse">0.0</span> MIN</strong>
  </div>

  <div class="total-leads">
    TOTAL LEADS TODAY — <strong><span id="totalLeads">0</span></strong>
  </div>
</div>

<div class="board" id="leadList"></div>

<div class="footer">Business Hours: 8:00 AM – 5:00 PM</div>

<script>

function updateClock() {
  const now = new Date();
  document.getElementById("clock").innerText = now.toLocaleTimeString();
}
setInterval(updateClock, 1000);
updateClock();

function formatDate() {
  const now = new Date();
  return now.toLocaleDateString(undefined, {
    weekday: 'long',
    month: 'long',
    day: 'numeric'
  });
}

async function fetchDashboard() {
  const response = await fetch('/dashboard-data');
  const data = await response.json();

  document.getElementById("count").innerText = data.active.length;
  document.getElementById("avgResponse").innerText = data.avgResponse;
  document.getElementById("totalLeads").innerText = data.totalLeadsToday;

  document.getElementById("avgTitle").innerText =
    `AVG SPEED TO FIRST CALL — ${formatDate()}`;

  const avg = parseFloat(data.avgResponse);
  const container = document.getElementById("avgContainer");

  container.classList.remove("avg-green", "avg-yellow", "avg-red");

  if (avg < 3) container.classList.add("avg-green");
  else if (avg <= 5) container.classList.add("avg-yellow");
  else container.classList.add("avg-red");

  const list = document.getElementById("leadList");
  list.innerHTML = "";

  data.active.forEach(lead => {
    const minutes = Math.floor((Date.now() - lead.created_at) / 60000);

    let status = "green";
    if (minutes >= 3) status = "yellow";
    if (minutes >= 5) status = "red";

    const div = document.createElement("div");
    div.className = "lead-card " + status;

    div.innerHTML = `
      <div class="lead-info">
        <div>${lead.name}</div>
        <div class="lead-source">${lead.source || "Unknown Source"}</div>
      </div>
      <div>${minutes} min</div>
    `;

    list.appendChild(div);
  });
}

setInterval(fetchDashboard, 5000);
fetchDashboard();

</script>

</body>
</html>
